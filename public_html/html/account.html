<!DOCTYPE html>
<html>
    <head>
        <title>SwapOmen</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body onload="f()">
        <div id="outer">
            <header>
                <h1>SwapOmen</h1>
            </header>

            <main>
                <div id="current-username"></div>
                <div id="current-email"></div>
                <button onclick="logoutUser()">Logout</button>
                <br><br>
                <div id="admin-button">
                    <button onclick="gotoAdminPage()">FOR ADMINS ONLY!!!</button>
                </div>
                <button onclick="window.location.assign('/tradeOffers');">Trade Offers</button>
                <br>
                Input password: <input id="password" value=""><br>
                <button onclick="deleteLoggedInUser()">Delete Account</button>
            </main>
        </div>

        <!-- SCRIPTS -->
        <script src="/js/httpRequests.js"></script>
        <script src="/js/webserverInterface.js"></script>
        <script>
            async function f() {
                console.log("On account page");

                // Gets the user info and shows it on the screen
                var currentUserInfo = JSON.parse(await getUserInfo());
                document.getElementById("current-username").innerHTML = `Hello,  ${currentUserInfo.name}`;
                document.getElementById("current-email").innerHTML = `Your email is '${currentUserInfo.email}'`;

                // Determine if user is an admin and show admin button if so
                if (currentUserInfo.accessLevel >= 3) document.getElementById("admin-button").style.display = "block";
                else document.getElementById("admin-button").style.display = "none";
            }

            async function logoutUser() {
                logout();
                getUserInfo();
                window.location.assign('/login');
            }

            async function gotoAdminPage() {
                window.location.assign('/admin');
            }

            async function deleteLoggedInUser() {
                var currentUserInfo = JSON.parse(await getUserInfo());
                console.log(currentUserInfo.name, currentUserInfo.email, currentUserInfo.uid, currentUserInfo.ID);
                console.log(currentUserInfo);
                console.log(document.getElementById("password").value);
                await deleteAccountV2(currentUserInfo.name, currentUserInfo.email, document.getElementById("password").value);
                logout();
                window.location.assign("/");
            }
        </script>
    </body>
</html>